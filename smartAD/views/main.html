<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="charset=UTF-8">
        <link href="main.css" type="text/css" rel="stylesheet"></link>
        <link rel="shortcut icon" href="">
        <script src = "https://cdn.socket.io/socket.io-1.4.5.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/leapjs@0.6.4/leap-0.6.4.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/leapjs@0.6.4/leap-0.6.4.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.2.js" type="text/javascript"></script>
        <script>
            var socket = io.connect("http://localhost:3002");
        </script>
    </head>
    <body onload = "printClock()">
        <div id = "videoDiv">
            <video id = "video" poster="/img/defaultImg.PNG"  style= "top: 0; width : auto;
            height : auto; float: left; z-index : -1; width: 80%; height: 100%;" controls="controls" preload="none" autoplay= "autoplay" muted>
                <source id ="url" src="https://s3.ap-northeast-2.amazonaws.com/sopt-seminar/%ED%83%84%EC%82%B0%EC%9D%8C%EB%A3%8C_1318_%EA%B3%B5%ED%86%B5/%5B%EC%98%A4%EB%9E%91%EC%A7%80%EB%82%98%5D+TVCF+30_.mp4" type="video/mp4" />
            </video>
            <!-- <div id = "leapMotion" style= "top: 0; position: absolute; width : auto;
            height : auto; float: left; z-index : 0; width: 79.3%; height: 100%; background-color: #222; display: none;">
                <br><span id = "count" class = "finishMessage">3</span>
                <span class = "finishMessage">초 후에 종료 됩니다</span>
            </div>        -->
            <div id = "analysis" style= "top: 0; position: absolute; width : auto;
            height : auto; float: left; z-index : 0; width: 79.3%; height: 100%; background-color: #222; display: none;">
                <img src = "/img/face-scan.svg" style ="display: block; margin-top: 80px; width: 120px; height: 120px; margin-left: auto; margin-right: auto;"/>
                <br><span id = "age" class = "identity" style = "text-align: center; display: block; margin-top: 50px; margin-left: 300px; float: left;">30대</span>
                <span id = "gender" class = "identity" style = "text-align: center; display: block; margin-top: 50px; margin-left: 15px; float: left;">여성</span>
                <span class = "identity" style = "text-align: center; display: block; margin-left: auto; margin-top: 50px; margin-left: 15px; float: left;">사용자의 정보를 수집 어쩌구 저쩌구 어쩌구 저쩌구</span>
                <img src = "/img/spinner.svg" style ="display: block; width: auto; height: auto; margin-top: 340px; margin-left: auto; margin-right: auto;"/>
            </div>
            <!-- <div id = "defaultImg" style= "top: 0; position: absolute; width : auto;
            height : auto; float: left; z-index : 1; width: 79.3%; height: 100%; background-color: #fff;">
                <img src = "/img/defaultImg.PNG" style = "width: 79.3%; height: 100%"/>
            </div>   -->
        </div> 

        <div id = "clockDiv" style = "float: left; width: 20%; height: 38%; color: #444;"> 
            <br><br><br><br><br><font id = "clock"></font> 
        </div>

        <div style = "float: right; width: 20%; height: 38%;">
            <br><span id = "city">도봉구</span><br>
            <img src = "/img/cloud.png" style = "float: right;"/>
            <br><span id = "temperature">22</span>
            <span id = "do">℃</span>
            <span class = "insideTemperature">/</span>
            <span class = "insideTemperature" id = "insideTemperature">25</span>
            <span id = "insideDo">℃</span>
        </div>
        
        <div style = "float: left; width: 20%; height: 26%; background-color: #5699d2;"></div>
        <script>
            // socket.on("weather", function (didata) {
            //     var weather = document.getElementById("temperature"); 
            //     weather.innerHTML = data;
            // });

            socket.on("ad", function (data) {
                var video = document.getElementById("video");
                var url = document.getElementById("url");
                url.src = data[0]['url'];
                document.getElementById("analysis").style.display = "block";
                setTimeout(function() {
                    document.getElementById("analysis").style.display = "none";
                    video.load(); 
                    video.play();
                }, 3000);
            });
            

            socket.on("ad", function (data) {
                var video = document.getElementById("video");
                var url = document.getElementById("url");
                url.src = data[0];

                document.getElementById("analysis").style.display = "block";
                document.getElementById("defaultImg").style.display = "none";
                // document.getElementById("leapMotion").style.display = "none";

                //age
                var age = document.getElementById("age"); 
                age.innerHTML = data[1];
                
                //gender
                var gender = document.getElementById("gender"); 
                gender.innerHTML = data[2];

                setTimeout(function() {
                    document.getElementById("analysis").style.display = "none";
                    video.load(); 
                    video.play();
                }, 5000);  
                //립 모션 이벤트 시작
            });

            document.getElementById('video').addEventListener('ended', function() {
                // document.getElementById("leapMotion").style.display = "block";
                socket.emit("restart");
            });
            // socket.on("weather_text", function (data) {
            //     if(data = "흐리다"){

            //     }
            //     document.getElementById("weatherImg").src = ; 
            // });

            function printClock() {
            
                var clock = document.getElementById("clock");            // 출력할 장소 선택
                var currentDate = new Date();                                     // 현재시간
                var amPm = 'AM'; // 초기값 AM
                var currentHours = addZeros(currentDate.getHours(), 2); 
                var currentMinute = addZeros(currentDate.getMinutes() , 2);
                var currentSeconds =  addZeros(currentDate.getSeconds(), 2);
                let weatherURL ='https://weather.naver.com/rgn/townWetr.nhn?naverRgnCd=09320105';

                if(currentHours >= 12) { // 시간이 12보다 클 때 PM으로 세팅, 12를 빼줌
                    amPm = 'PM';
                    currentHours = addZeros(currentHours - 12, 2);
                }

                clock.innerHTML = "<span id = amPm>" + amPm + " </span>" + 
                                "<span id = time>" + currentHours + ":" + currentMinute + "</span><br><br>" + 
                                "<span class = dateBold style = 'padding-left: 0px;'>" + currentDate.getDate() + "</span>" +
                                "<span id = day>" + getEnglishDay(currentDate.getDay()) + "</span>" +
                                "<span class = dateBold>" + getEnglishMonth((currentDate.getMonth()+1)) + "</span>" +
                                "<span id = year>" + currentDate.getFullYear() + "</span>";
                
                $(document).ready(function(){
                    $.ajax({
                        type : "GET",
                        url : "http://192.168.99.25",
                        crossDomain : true,
                        headers: {
                            // 'Access-Control-Allow-Origin':'*'
                        },
                        dataType : "text/html",
                        error : function(error){
                            console.log(error)
                            console.log("통신 실패!")
                        },
                        success : function(result){
                            var data_result = $("#insideTemperature").html(result).find('div'); //div에 받아온 값을 넣는다.
                            $("#insideTemperature").html(data_result).css({'margin-top':'20px','padding-left':'8px','font-size':'25px','font-family':'나눔스퀘어 Light','color':'#888'});
                        }
                    });
                });
                setTimeout("printClock()", 10000);         // 1분 마다 printClock() 함수 호출
            }
            
            function addZeros(num, digit) {  // 자릿수 맞춰주기
                
                var zero = '';
                num = num.toString();
                if (num.length < digit) {
                    for (i = 0; i < digit - num.length; i++) {
                        zero += '0';
                    }
                }
                return zero + num;
            }

            function getEnglishDay(day) {
                
                switch(day) {
                    case 0 :
                        return "Sun";
                    case 1 :
                        return "Mon";
                    case 2 :
                        return "Tue";
                    case 3 :
                        return "Wed"; 
                    case 4 :
                        return "Thu";
                    case 5 :
                        return "Fri";
                    case 6 :
                        return "Sat"; 
                    default :
                        return "Nan"
                }
            }

            function getEnglishMonth(month) {
                
                switch(month) {
                    case 1 :
                        return "Jan";
                    case 2 :
                        return "Feb";
                    case 3 :
                        return "Mar";
                    case 4 :
                        return "Apr"; 
                    case 5 :
                        return "May";
                    case 6 :
                        return "Jun";
                    case 7 :
                        return "Jul"; 
                    case 8 :
                        return "Aug";
                    case 9 :
                        return "Sep";
                    case 10 :
                        return "Oct";
                    case 11 :
                        return "Nov"; 
                    case 12 :
                        return "Dec";
                    default :
                        return "Nan";
                }
            }
        </script>
        <script>
            var controller = Leap.loop({enableGestures: true}, function(frame) {
                    // Display Gesture object data
                if (frame.gestures.length > 0) {
                    for (var i = 0; i < frame.gestures.length; i++) {
                        var gesture = frame.gestures[i];
                        var duration = gesture.duration;
                        if(gesture.type == "swipe") {
                            //Classify swipe as either horizontal or vertical
                            var isHorizontal = Math.abs(gesture.direction[0]) > Math.abs(gesture.direction[1]);
                            //Classify as right-left or up-down
                            if(isHorizontal){
                                if(gesture.direction[0] > 0){
                                    swipeDirection = "right";
                                } else {
                                    swipeDirection = "left";
                                }
                            console.log(swipeDirection)
                            console.log(duration)
                            } 
                        }
                    }
                }
            });
        </script>
    </body>
</html>
