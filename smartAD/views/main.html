<!DOCTYPE>
<html>
    <head>
        <meta http-equiv="Content-Type" content="charset=UTF-8">
        <link href="main.css" type="text/css" rel="stylesheet"></link>
        <script src = "https://cdn.socket.io/socket.io-1.4.5.js"></script>
        <script>
            var socket = io.connect("http://localhost:3000");
        </script>
        <script> const request = require('request'); </script>
        <script> const cheerio = require('cheerio'); </script>
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    </head>
    <body onload = "printWeather()">
        <div id = "videoDiv">
            <video id = "video" poster="http://placehold.it/640x360"  style= "top: 0; width : auto;
            height : auto; float: left; z-index : -1; width: 80%; height: 100%;" controls="controls" preload="none" autoplay= "autoplay" muted>
                <source id ="url" src="https://sopt-seminar.s3.ap-northeast-2.amazonaws.com/%EA%B0%84%ED%8E%B8%EC%8B%9D+%EA%B4%91%EA%B3%A0_1318_%EC%97%AC%EC%9E%90/%EB%A7%88%EC%BC%93%EC%98%A4%EB%84%A4%EC%9D%B4%EC%B2%98+%ED%8C%8C%EC%8A%A4%ED%83%80%EC%B9%A9+-+%ED%8C%8C%EC%8A%A4%ED%83%80_%EC%A7%91_%EC%9C%BC%EB%A1%9C(30_s+ver).mp4" type="video/mp4" />
            </video>       
            <div id = "analysis" style= "top: 0; position: absolute; width : auto;
            height : auto; float: left; z-index : 0; width: 79.3%; height: 100%; background-color: #222;">
                <img src = "img/face-scan.svg" style ="display: block; margin-top: 60px; width: 120px; height: 120px; margin-left: auto; margin-right: auto;"/>
                    <br><span id = "age" class = "identity" style = "text-align: center; display: block; margin-top: 50px; margin-left: 300px; float: left;">30대</span>
                    <span id = "gender" class = "identity" style = "text-align: center; display: block; margin-top: 50px; margin-left: 15px; float: left;">여성</span>
                    <span class = "identity" style = "text-align: center; display: block; margin-left: auto; margin-top: 50px; margin-left: 15px; float: left;">사용자의 정보를 수집 어쩌구저쩌구 어쩌구 저쩌구</span>
                    <img src = "img/spinner.svg" style ="display: block; width: auto; height: auto; margin-top: 340px; margin-left: auto; margin-right: auto;"/>
            </div>
        </div> 

        <div id = "clockDiv" style = "float: left; width: 20%; height: 38%; color: #444;"> 
            <br><br><br><br><br><font id = "clock"></font> 
        </div>

        <div style = "float: right; width: 20%; height: 38%;">
            <br><span id = "city">강북구</span><br>
            <img src = "img/cloud.png" style = "float: right;">
            <br><span id = "temperature">30</span>
            <span id = "do">℃</span>
            <span id = "insideTemperature">/25</span>
            <span id = "insideDo">℃</span>
        </div>
        
        <div style = "float: left; width: 20%; height: 26%; background-color: #5699d2;"></div>
        <script>
            socket.on("ad", function (data) {
                var video = document.getElementById("video");
                var url = document.getElementById("url");
                url.src = data[0];
                document.getElementById("analysis").style.display = "block";
                //팝업창 띄우는 이벤트 시작
                //age
                var age = document.getElementById("age"); 
                age.innerHTML = data[1];
                
                //gender
                var gender = document.getElementById("gender"); 
                gender.innerHTML = data[2];

                setTimeout(function() {
                    document.getElementById("analysis").style.display = "none";
                    video.load(); 
                    video.play();
                }, 6000);  
                //립 모션 이벤트 시작
                // a = 0;
                // socket.emit('restart', a);//다시 얼굴 인식 시작
                // console.log("restart_1");
            });

            // socket.on("weather_text", function (data) {
            //     if(data = "흐리다"){

            //     }
            //     document.getElementById("weatherImg").src = ; 
            // });

            document.getElementById('video').addEventListener('ended', function(){

                // var ad_url_save = [];
                // socket.on("save",function(data){
                //     ad_url_save.append(data);//ad_url_dave[0]이 사용자가 립모션에서 다시보기 선택 시 틀어줄 광고 url
                // });

                // socket.emit("first");
                // video.pause();
                // a = 0;
                // console.log("restart_1");
                // socket.emit('restart', a);//다시 얼굴 인식 시작
                // console.log("restart_1");
            });

            function printWeather(){
                let url ='https://weather.naver.com/rgn/townWetr.nhn?naverRgnCd=09320105';
                request(url, (err, res, body)=> {
                    if(err) {
                        console.log(err);
                        return;
                    }
                    let $ = cheerio.load(body);

                    $('.fl').each(function(post){
                        var weather_crawling=(($(this).children()[1])['children'][0])['data'];
                        var _weather=parseInt(weather_crawling.replace(/(\s*)/g,''));
                        // weather_text=((((($(this).children()[1])['children'][0])['next'])['next'])['children'][0])['data'];
                        document.getElementById("temperature").innerHTML = toString(_weather);
                    });
                });

                setInterval(printWeather, 1000); 
            }

            function printClock() {
            
                var clock = document.getElementById("clock");            // 출력할 장소 선택
                var currentDate = new Date();                                     // 현재시간
                var amPm = 'AM'; // 초기값 AM
                var currentHours = addZeros(currentDate.getHours(), 2); 
                var currentMinute = addZeros(currentDate.getMinutes() , 2);
                var currentSeconds =  addZeros(currentDate.getSeconds(), 2);
                let url ='https://weather.naver.com/rgn/townWetr.nhn?naverRgnCd=09320105';

                if(currentHours >= 12) { // 시간이 12보다 클 때 PM으로 세팅, 12를 빼줌
                    amPm = 'PM';
                    currentHours = addZeros(currentHours - 12, 2);
                }
                clock.innerHTML = "<span id = amPm>" + amPm + " </span>" + 
                                "<span id = time>" + currentHours + ":" + currentMinute + "</span><br><br>" + 
                                "<span class = dateBold style = 'padding-left: 0px;'>" + currentDate.getDate() + "</span>" +
                                "<span id = day>" + getEnglishDay(currentDate.getDay()) + "</span>" +
                                "<span class = dateBold>" + getEnglishMonth((currentDate.getMonth()+1)) + "</span>" +
                                "<span id = year>" + currentDate.getFullYear() + "</span>";
                
                setTimeout(printClock, 10000);         // 1초마다 printClock() 함수 호출
                                
                // client.fetch(url, function(err, $, res) {
                //     if(err) {
                //         console.log(err);
                //         return;
                //     }
                //     $('.fl').each(function(post){
                //         var weather_crawling=(($(this).children()[1])['children'][0])['data'];
                //         var _weather=parseInt(weather_crawling.replace(/(\s*)/g,''));
                //         // weather_text=((((($(this).children()[1])['children'][0])['next'])['next'])['children'][0])['data'];
                //         var weather = document.getElementById("temperature"); 
                //         weather.innerHTML = _weather;
                //     });
                // });         
            
                // // setTimeout(printClock, 1000);         // 1초마다 printClock() 함수 호출
            }
            
            function addZeros(num, digit) {  // 자릿수 맞춰주기
                
                var zero = '';
                num = num.toString();
                if (num.length < digit) {
                    for (i = 0; i < digit - num.length; i++) {
                        zero += '0';
                    }
                }
                return zero + num;
            }
            function getEnglishDay(day) {
                
                switch(day) {
                    case 0 :
                        return "Sun";
                    case 1 :
                        return "Mon";
                    case 2 :
                        return "Tue";
                    case 3 :
                        return "Wed"; 
                    case 4 :
                        return "Thu";
                    case 5 :
                        return "Fri";
                    case 6 :
                        return "Sat"; 
                    default :
                        return "Nan"
                }
            }
            function getEnglishMonth(month) {
                
                switch(month) {
                    case 1 :
                        return "Jan";
                    case 2 :
                        return "Feb";
                    case 3 :
                        return "Mar";
                    case 4 :
                        return "Apr"; 
                    case 5 :
                        return "May";
                    case 6 :
                        return "Jun";
                    case 7 :
                        return "Jul"; 
                    case 8 :
                        return "Aug";
                    case 9 :
                        return "Sep";
                    case 10 :
                        return "Oct";
                    case 11 :
                        return "Nov"; 
                    case 12 :
                        return "Dec";
                    default :
                        return "Nan";
                }
            }
        </script>
    </body>
</html>
